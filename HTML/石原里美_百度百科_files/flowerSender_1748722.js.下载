define("wiki-lemma:widget/lemma_content/configModule/flower/flowerSender/flowerSender",function(e,i,n){var o=e("wiki-common:widget/lib/jquery/jquery"),a=(e("wiki-common:widget/component/userLogin/userLogin"),e("wiki-lemma:widget/lemma_content/configModule/shushuo/shushuoRank/flower")),r=e("wiki-common:widget/ui/overlay/overlay"),c=e("wiki-common:widget/ui/dialog/dialog"),t=e("wiki-lemma:widget/lemma_content/configModule/flower/flowerSender/messager"),s=new r,d={message_namespace:"baikebindcard",service_type:"baike_actbindcard"},l="",m=function(e){function i(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=bindCardSrc.match(i);return null!=n?n[2]:void 0}var n=o("#starFlower"),r=n.find("#starFlower .flower-tip"),m=n.find(".bg em"),f=a.getInstance(e),w=o("#starFlower .bg .count"),u=m.css("background"),h=n.find("label"),g=!0,b=!1,p=function(e){if(w.text(e.totalScore),e.isLogin){if(e.showWalletBindTips||4!==e.errno?h.html("今日剩余<em>"+e.leftFlowers+"</em>朵"):(n.on("mouseover",function(){h.html("鲜花送完了</br>明天再来吧~")}),n.on("mouseout",function(){h.hide()})),0===e.leftFlowers&&e.showWalletBindTips||1===e.leftFlowers&&e.showWalletBindTips){if(h.hide(),o(".bind-card").is(":visible")!==!1)return;o(".bind-card").css("display","block");{setTimeout(function(){o(".bind-card").css("display","none")},6e3)}document.getElementById("goBind").onclick=function(){if(g){var n='<div class="card-iframe-wrap"><iframe class="bind-card-iframe" height="500" width="960"style="margin:0 auto; display: block;" frameborder="0" scrolling="no"></iframe><a href="javascript:;" class="close-btn"><em class="cmn-icon cmn-icons cmn-icons_close"></em></a></div>';o("body").append(n);var a=o(".bind-card-iframe"),r=o(".card-iframe-wrap");a.attr("src",e.walletBindUrl+"&"+encodeURIComponent(JSON.stringify(d)));var c=(o(window).height(),o(window).width());bindCardSrc=o(".bind-card-iframe")[0].src;var m=(o(".card-iframe-wrap").innerHeight(),o(".card-iframe-wrap").innerWidth());r.css("left",(c-m)/2+"px").css("top","50px").css("position","fixed"),g=!1,1==o(".bind-card-iframe").length&&(l=i("order_no"))}else o(".bind-card-iframe").attr("src",e.walletBindUrl+"&"+encodeURIComponent(JSON.stringify(d))),o(".bind-card-iframe").show(),bindCardSrc=o(".bind-card-iframe")[0].src,l=i("order_no");t.addNotice(function(e,i){switch(e=e.replace(new RegExp("^"+d.message_namespace+"_"),"")){case"resize":o(".card-iframe-wrap").height(i.height);break;case"submit_result":i.result+""=="0"&&o.getJSON("/operation/api/getbindstatus",{order_no:l},function(e){window.location.replace(0===e.errno&&e.success===!0?window.location.href+"?bind#true":window.location.href+"?bind#false"),o(".close-btn").on("click",function(){o(".card-iframe-wrap").fadeOut(),s.hide(),window.location.reload(!0)})})}}),s.show(),o(".card-iframe-wrap").fadeIn(),o(".bind-card-iframe").show(),o(".close-btn").on("click",function(){o(".card-iframe-wrap").fadeOut(),s.hide()})}}else h.html("今日剩余<em>"+e.leftFlowers+"</em>朵");var a=window.location.hash.slice(-4);"true"===a&&(c.alert({icon:"CHECK",mainMsg:"绑卡成功",subMsg:"喵~500朵花到啦到啦~",autoCloseTime:3}),window.location.hash="");var r=window.location.hash.slice(-5);"false"===r&&(c.alert({icon:"ERROR",mainMsg:"加花失败",subMsg:"呜呜~不能参加活动呢~",autoCloseTime:3}),window.location.hash=""),n.on("mouseover",function(){o(".bind-card").is(":visible")===!1?h.show():h.hide()}),n.on("mouseout",function(){h.hide()})}else h.hide()},k=function(){f.regist({handleRankSuccess:function(e){p(e)},handleVoteSuccess:function(e){b=!1,m.css("background",u).addClass("up"),setTimeout(function(){m.removeClass("up").css("background","none")},500),p(o.extend(e,{isLogin:!0}))},handleVoteFail:function(e){b=!1,p(o.extend(e,{isLogin:!0}))},handleVoteError:function(e){8===e.errno&&h.html("今日设备送花账号已达上限")}}),f.getRank(),n.on("click",function(){b||(b=!0,r.remove(),f.vote())})};k()};o(".bind-card .close").on("click",function(){o(".bind-card").css("display","none")}),n.exports=m});