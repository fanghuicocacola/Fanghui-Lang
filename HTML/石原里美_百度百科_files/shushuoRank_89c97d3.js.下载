define("wiki-lemma:widget/lemma_content/configModule/shushuo/shushuoRank/shushuoRank",function(n,e,s){var a=n("wiki-common:widget/lib/jquery/jquery"),i=n("wiki-common:widget/component/nslog/nslog"),t=n("wiki-lemma:widget/lemma_content/configModule/shushuo/shushuoRank/flower"),r=n("wiki-common:widget/lib/jsmart/jsmart");s.exports.init=function(n){var e=t.getInstance(n),s={init:function(){this.$weekTab=a("#J-week-tab"),this.$rankContainer=a("#J-rank-container"),this.rankInfo=new r('<div class="rank-info">\n<div class="rank-item rank-num{%if $rank.rank|numLen%} special{%/if%}">\n<a class="rank-link" href="{%if $rank.oriScore > 0%}/starrank?lemmaId={%$config.lemmaId|f_escape_path%}&lemmaTitle={%$config.lemmaTitle|f_escape_path%}&rankType={%$config.rankType|f_escape_path%}&weekType={%$weekType|f_escape_path%}{%else%}/starrank{%/if%}" target="_blank">\n<span class="rank-tip">排名</span><br>\n<span class="rank-score">NO.{%$rank.rank|f_escape_xml%}</span>\n<em class="cmn-icon cmn-icons cmn-icons_arrow-r-2"></em>\n</a>\n</div>\n<div class="rank-item rank-pic">\n<div class="portrait-container">\n<a class="rank-link" href="{%if $rank.oriScore > 0%}/starrank?lemmaId={%$config.lemmaId|f_escape_path%}&lemmaTitle={%$config.lemmaTitle|f_escape_path%}&rankType={%$config.rankType|f_escape_path%}&weekType={%$weekType|f_escape_path%}{%else%}/starrank{%/if%}" target="_blank">\n{%if $rank.rank == 1%}\n<img src="https://bkssl.bdimg.com/static/wiki-lemma/widget/lemma_content/configModule/shushuo/shushuoRank/img/first_f577b16.svg" alt="" class="crown">\n{%elseif $rank.rank == 2%}\n<img src="https://bkssl.bdimg.com/static/wiki-lemma/widget/lemma_content/configModule/shushuo/shushuoRank/img/second_aa48ebc.svg" alt="" class="crown">\n{%elseif $rank.rank == 3%}\n<img src="https://bkssl.bdimg.com/static/wiki-lemma/widget/lemma_content/configModule/shushuo/shushuoRank/img/third_84c0c82.svg" alt="" class="crown">\n{%/if%}\n<img src="{%$rank.picUrl|f_escape_xml%}" alt="" class="portrait">\n</a></div>\n</div>\n<div class="rank-item rank-flower">\n<a class="rank-link" href="{%if $rank.oriScore > 0%}/starrank?lemmaId={%$config.lemmaId|f_escape_path%}&lemmaTitle={%$config.lemmaTitle|f_escape_path%}&rankType={%$config.rankType|f_escape_path%}&weekType={%$weekType|f_escape_path%}{%else%}/starrank{%/if%}" target="_blank">\n<span class="rank-tip">鲜花</span><br>\n<span class="rank-score">{%$rank.score|f_escape_xml%}</span>\n<em class="cmn-icon cmn-icons cmn-icons_arrow-r-2"></em>\n</a></div>\n</div>\n<p class="star-name">\n<a class="rank-link" href="{%if $rank.oriScore > 0%}/starrank?lemmaId={%$config.lemmaId|f_escape_path%}&lemmaTitle={%$config.lemmaTitle|f_escape_path%}&rankType={%$config.rankType|f_escape_path%}&weekType={%$weekType|f_escape_path%}{%else%}/starrank{%/if%}" target="_blank">{%$rank.name|f_escape_xml%}</a>\n</p>\n{%if $weekType == \'thisWeek\'%}\n<div class="send-container">\n{%if $isLogin && $leftFlowers == 0%}\n<div class="flower-tip" id="J-leftFlower-tips">\n今日剩余0朵，来<a href="/mall/category?class=8" target="_blank" nslog-type="10001701">商城</a>兑换吧~</div>\n{%/if%}\n<div class="send-btn" id="J-send-btn">\n{%if $isLogin && $leftFlowers > 0%}\n<span class="left-flower-tip" id="J-send-tips"></span>\n{%/if%}\n<em {%if $leftFlowers == 0%}class="empty"{%/if%}></em><span class="send-text{%if $leftFlowers == 0%} empty{%/if%}">给TA送花</span>\n</div>\n</div>\n<p class="score-info{%if $isLogin && $leftFlowers == 0%} no-flower{%/if%}">{%if $rank.diff%}距离上一名还差<b>{%$rank.diff|f_escape_xml%}</b>朵{%else%}击败了所有其他明星！{%/if%}</p>\n{%/if%}\n{%if $weekType == \'lastWeek\'%}\n<p class="score-info total-flower">历史累计鲜花<b>{%$rank.totalScore|f_escape_xml%}</b>朵</p>\n{%/if%}\n<div class="rank-fans{%if $isLogin%} long{%/if%}{%if $fans.list eq 0%} no-fans{%/if%}{%if !$isLogin && $fans.list eq 0%} none{%/if%}">\n{%if count($fans.list) neq 0%}\n<h4 class="fans-title">粉丝送花榜</h4>\n<ul class="fans-list">\n{%foreach $fans.list as $item%}\n{%if $item@index == 1%}\n<li class="fans-item">\n<div class="portrait-container{%if $item.rank==1%} champion{%/if%}">\n<img src="{%$item.picUrl|f_escape_xml%}" alt="" class="portrait{%if $item.rank==1%} champion{%/if%}">\n<span class="fans-rank{%if $item.rank==1%} first{%elseif $item.rank==2%} second{%else%} third{%/if%}">{%$item.rank|f_escape_xml%}</span>\n</div>\n<span class="fans-name">{%$item.uname|f_escape_xml%}</span>\n<span class="flower-num">送花{%$item.score|f_escape_xml%}</span>\n</li>\n{%/if%}\n{%/foreach%}\n{%foreach $fans.list as $item%}\n{%if $item@index == 0%}\n<li class="fans-item">\n<div class="portrait-container{%if $item.rank==1%} champion{%/if%}">\n<img src="{%$item.picUrl|f_escape_xml%}" alt="" class="portrait{%if $item.rank==1%} champion{%/if%}">\n<span class="fans-rank{%if $item.rank==1%} first{%elseif $item.rank==2%} second{%else%} third{%/if%}">{%$item.rank|f_escape_xml%}</span>\n</div>\n<span class="fans-name">{%$item.uname|f_escape_xml%}</span>\n<span class="flower-num">送花{%$item.score|f_escape_xml%}</span>\n</li>\n{%/if%}\n{%/foreach%}\n{%foreach $fans.list as $item%}\n{%if $item@index == 2%}\n<li class="fans-item">\n<div class="portrait-container{%if $item.rank==1%} champion{%/if%}">\n<img src="{%$item.picUrl|f_escape_xml%}" alt="" class="portrait{%if $item.rank==1%} champion{%/if%}">\n<span class="fans-rank{%if $item.rank==1%} first{%elseif $item.rank==2%} second{%else%} third{%/if%}">{%$item.rank|f_escape_xml%}</span>\n</div>\n<span class="fans-name">{%$item.uname|f_escape_xml%}</span>\n<span class="flower-num">送花{%$item.score|f_escape_xml%}</span>\n</li>\n{%/if%}\n{%/foreach%}\n</ul>\n{%else%}\n<div class="no-data">\n<h4 class="fans-title">粉丝送花榜</h4>\n暂无粉丝送花</div>\n{%/if%}\n{%if $isLogin%}\n<div class="user-info">\n<p class="rank-info">我{%if $weekType == \'thisWeek\'%}本周{%/if%}\n{%if $weekType == \'lastWeek\'%}上周{%/if%}\n送花<b>{%$fans.score|f_escape_xml%}</b>朵，排名<b>第{%$fans.rank|f_escape_xml%}</b>\n</p>\n{%if $weekType == \'thisWeek\'%}\n{%if $fans.rank == 1%}\n<p class="total-info">击败了所有其他粉丝!</p>\n{%else%}\n<p class="total-info">距上一名还差{%$fans.diff|f_escape_xml%}朵</p>\n{%/if%}\n{%/if%}\n{%if $weekType == \'lastWeek\'%}<p class="total-info">累计送花{%$fans.totalScore|f_escape_xml%}朵</p>{%/if%}\n</div>\n{%/if%}\n</div>\n</div>'),this.rankConfig=n,this.oriLeftFlowers="",this.isSending=!1,this.extendJsmartPlugin(),this.getRankData(),this.bindEvent()},getRankData:function(){var n=this;e.regist({handleRankSuccess:function(e){n.renderWeekInfo(e),e.isLogin&&n.renderLeftFlowers(e)},handleVoteSuccess:function(e){n.renderThisWeek(e)},handleVoteError:function(n){8===n.errno&&(a("#J-thisWeek-container").find(".send-container").prepend('<div class="flower-tip" id="J-xaf-tips">今日设备送花账号已达上限</div>'),a("#J-thisWeek-container").find("#J-send-tips").addClass("disabled-num"),a("#J-thisWeek-container").find("#J-send-btn em").addClass("empty"),a("#J-thisWeek-container").find("#J-send-btn .send-text").addClass("empty"),a("#J-thisWeek-container").find(".score-info").addClass("no-flower"))}}),e.getRank()},renderThisWeek:function(n){var e=this;a("#J-thisWeek-container").html(e.rankInfo.fetch({rank:n.thisWeek,fans:n.thisWeekFans,isLogin:!0,weekType:"thisWeek",config:e.rankConfig,leftFlowers:n.leftFlowers})),e.renderSendTip(n.leftFlowers,!0),e.oriLeftFlowers=n.leftFlowers},renderWeekInfo:function(n){var e=this;a("#J-thisWeek-container").html(e.rankInfo.fetch({rank:n.thisWeek,fans:n.thisWeekFans,isLogin:n.isLogin,weekType:"thisWeek",config:e.rankConfig,leftFlowers:n.leftFlowers})),a("#J-lastWeek-container").html(e.rankInfo.fetch({rank:n.lastWeek,fans:n.lastWeekFans,isLogin:n.isLogin,weekType:"lastWeek",config:e.rankConfig})),e.$rankContainer.find(".rank-loading").hide(),i(10090301)},renderLeftFlowers:function(n){var e=this;e.renderSendTip(n.leftFlowers,!1),e.oriLeftFlowers=n.leftFlowers},renderSendTip:function(n,e){var s=this;if(0===n)a("#J-send-tips").hide(),e||a("#J-leftFlower-tips").html('今日剩余0朵，来<a href="/mall/category?class=8" target="_blank" nslog-type="10001701">商城</a>兑换吧~');else{if(n>99&&a("#J-send-tips").addClass("special"),e)n>999&&a("#J-send-tips").addClass("normal"),a("#J-send-tips").html(n).show();else{var i=n>999?"999+":n;a("#J-send-tips").html(i).show()}s.isSending=!1}},bindEvent:function(){var n,s=this;s.$weekTab.on("mouseover","span",function(){var e=a(this),s=a(this).parents(".rank-content");n=setTimeout(function(){e.addClass("current").siblings("span").removeClass("current"),s.find(".rank-week[index="+e.attr("index")+"]").addClass("current").siblings(".rank-week").removeClass("current")},200)}).on("mouseout",function(){clearTimeout(n)}),a("#J-rank-content").on("click","#J-send-btn",function(){s.isSending||(e.vote(),i(10090302))}),s.$rankContainer.on("click",".rank-link",function(){i(10090303)}),s.$rankContainer.on("mouseover",".lastWeek",function(){i(10090304)});var t;a("#J-rank-content").on("mouseenter","#J-send-btn",function(){if(parseInt(s.oriLeftFlowers,10)>999&&!s.isSending){var n=32+6.9*(s.oriLeftFlowers.toString().length-4);t=setTimeout(function(){a("#J-send-tips").html(s.oriLeftFlowers),a("#J-send-tips").animate({width:n},"fast"),s.isSending=!1},200)}}).on("mouseleave","#J-send-btn",function(){parseInt(s.oriLeftFlowers,10)>999&&(a("#J-send-tips").html("999+"),a("#J-send-tips").animate({width:30},"fast"),clearTimeout(t),s.isSending=!1)})},extendJsmartPlugin:function(){r.prototype.registerPlugin("modifier","numLen",function(n){var e=parseInt(n,10);return e>999?!0:void 0})}};s.init()}});